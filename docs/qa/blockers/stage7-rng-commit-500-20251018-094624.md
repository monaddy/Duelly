# Blocker — RNG Fairness: `POST /api/v2/rng/commit` returns **HTTP 500**

**Status:** HOLD_FOR_APPROVAL • **Stage:** 7 (Perf, Fairness, Webhook, WS) • **Domain:** `play.duelly.online`  
**Generated:** 2025-10-18T09:46:24+00:00

## Acceptance Recap
- ✅ Health: `/api/v2/health` → `{ok:true}`
- ✅ Webhook (Telegram): wrong=401, right=200, dedup OK (`X-Telegram-Bot-Api-Secret-Token`)
- ✅ WS polling handshake: `/socket.io` (EIO=4)
- ❌ RNG Fairness Commit: **HTTP 500** (blocks Commit→Reveal→Verify flow)

## Quick Repro (should **NOT** 500)
```bash
curl -sS -X POST "https://play.duelly.online/api/v2/rng/commit"   -H 'Accept: application/json' -H 'Content-Type: application/json'   --data-binary '{"clientCommitHex":"d5d4750eefe3293ccf59be62c63eabc15d3856a1ce7eabb9ab95e09acc8c4f9a"}'   -D - -o /dev/null
```

**Expected:** 200 + JSON including `id` and `serverCommitHex`  
**Actual:** 500 (from Stage 7 QA runs)

## Artifacts & Logs
- Commit diagnostics: `/root/duelly/.duelly/artifacts/qa-723-rng-commit-root-cause-v1-20251018-085316-health.code`
- Latency baseline (health/socket.io/rng_commit): `/root/duelly/.duelly/artifacts/qa-730-latency-baseline-v1-20251018-091117`
- Webhook proof (401/200/dedup): `/root/duelly/.duelly/artifacts/qa-710-webhook-direct-v2-20251018-083741-ok2.code`
- WS handshake proof: `/root/duelly/.duelly/artifacts/qa-725-ws-handshake-v1-20251018-090223-open-socket-io-_4-get2.code`

## Suggested Fix Checklist
1. Guard input schema for `clientCommitHex` (hex format, 32 bytes hash); return **400** on bad input.
2. Avoid synchronous DB/blocking code that can throw; wrap with try/catch → map to **4xx**/**5xx** appropriately.
3. Add unit/integration test for the Commit→Reveal→Verify happy path and for invalid commit payloads.
4. Once fixed, re-run: `qa-720/721/722/723` steps → `qa-740` report → drop HOLD.

*This note was generated automatically by QA ChatOps.*
